"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),PropTypes=require("prop-types"),asyncGenerator=function(){function e(e){this.value=e}function t(t){function r(o,a){try{var i=t[o](a),s=i.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):n(i.done?"return":"normal",i.value)}catch(e){n("throw",e)}}function n(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}(o=o.next)?r(o.key,o.arg):a=null}var o,a;this._invoke=function(e,t){return new Promise(function(n,i){var s={key:e,arg:t,resolve:n,reject:i,next:null};a?a=a.next=s:(o=a=s,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},generator=regeneratorRuntime.mark(function e(t,r,n){var o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=0;case 1:if(!(o<=t.length-1)){e.next=8;break}return a=0===o,e.next=5,[].concat(toConsumableArray(t)).splice(o,a&&n>=0?n:r);case 5:o=a&&n>=0?o+n:o+r,e.next=1;break;case 8:case"end":return e.stop()}},e,this)}),Floodgate=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n=e.data,o=e.increment,a=e.initial;return r.queue=generator(n,o,a),r.data=n,r.state={renderedItems:[],allItemsRendered:!1},r.loadAll=r.loadAll.bind(r),r.loadNext=r.loadNext.bind(r),r.reset=r.reset.bind(r),r}return inherits(t,e),createClass(t,[{key:"componentDidMount",value:function(){this.loadNext()}},{key:"reset",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).callback;this.queue=generator(this.data,this.props.increment,this.props.initial),this.setState(function(e){return{renderedItems:[],allItemsRendered:!1}},function(){return e.loadNext({callback:t})})}},{key:"loadAll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{suppressWarning:!1},r=t.callback,n=t.suppressWarning;!this.state.allItemsRendered&&this.setState(function(t){return{renderedItems:e.data,allItemsRendered:!0}},function(){return r&&r(e.state)})||this.state.allItemsRendered&&!n&&console.warn("Floodgate: All items are rendered")}},{key:"loadNext",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).callback;!this.state.allItemsRendered&&this.setState(function(t){var r=e.queue.next().value,n=null!==r&&void 0!==r&&r.length>0,o=[].concat(toConsumableArray(t.renderedItems),toConsumableArray(n?r:[])),a=o.length===e.data.length;return{renderedItems:o,allItemsRendered:!!(!n||n&&a)}},function(){return t&&t(e.state)})}},{key:"render",value:function(){var e=this.loadAll,t=this.loadNext,r=this.reset,n=this.state,o=n.renderedItems,a=n.allItemsRendered;return this.props.children({items:o,loadComplete:a,loadAll:e,loadNext:t,reset:r})}}]),t}(React.Component);Floodgate.propTypes={children:PropTypes.func,data:PropTypes.array.isRequired,initial:PropTypes.number,increment:PropTypes.number},Floodgate.defaultProps={initial:5,increment:5},exports.default=Floodgate;
